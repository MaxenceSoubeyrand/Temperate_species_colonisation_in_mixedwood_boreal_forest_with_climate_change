662-175
487+180
859.91-509.40
657.45+126
850+783+350
784.3/5
200-169.97
783.45-14.75
126-14.75
4000*1.0465
65000/12
14.95+47.91+164.06+34.04+33.99+8.44+28.77+51.9+113.51+88.51+90.18+18.78
13000*0.04*10/365
13000*0.04
630.4+118.98
7500+12*3*2*500
43500+12*500
500000*45000
29+53
82/2
*1.15
41*1.15
41*1.10
set.seed(42876)
fr_border = sf::st_as_sf(geodata::gadm("GADM", country = "FRA", level = 0))
library(geodata)
install.packages("geodata")
fr_border = sf::st_as_sf(geodata::gadm("GADM", country = "FRA", level = 0))
sf_point = sf::st_sf(sf::st_sample(x = fr_border, size = 25, type = "random"))
climate_data = extract_nc_value(first_year = 2012,
last_year = 2015,
local_file = FALSE,
file_path = NULL,
sml_chunk = "2011-2023",
spatial_extent = fr_border,
clim_variable = "mean temp",
statistic = "mean",
grid_size = 0.25,
ecad_v = NULL,
write_raster = TRUE,
out = "raster_mean_temp.tiff",
return_data = TRUE)
install.packages("climateExtract")
library(climateExtract)
getClimateWizardData(coordinates=c(longitude=10.613975,latitude=34.933439),
scenario="rcp45", start_year=2020, end_year=2050,
metric=c("CD18","R02"), GCMs=c("bcc-csm1-1","BNU-ESM"))
install.packages("climateExtract")
install.packages("chillR")
library(chillR)
getClimateWizardData(coordinates=c(longitude=10.613975,latitude=34.933439),
scenario="rcp45", start_year=2020, end_year=2050,
metric=c("CD18","R02"), GCMs=c("bcc-csm1-1","BNU-ESM"))
install.packages("rclimateca")
devtools::install_github("paleolimbot/rclimateca")
install.packages("rclimateca")
rm(list=ls())
#Si ?a ne fonctionne pas, voir dansPhD/Colab/Marion
library(leaflet)
library(tidyverse)
library(ggthemes)
library(mapview)
library(rgdal)
library(htmlwidgets)
library(leaflegend)
library(sf)
library(maps)
library(ggspatial)
library(ggnewscale)
library(rgeos)
library(grid)
library(ggplotify)
library(cowplot)
library(ggpubr)
library(viridis)
#Ok save image in pdf and maybe opacity of labels
PEP <- read.csv("~/PhD/Chap1/SORTIE/Change_par_lancer_SORTIE/Data/FERLD_PEP_climateNA/PEP_climateNA.csv") %>%
filter(!ID1 %in% c("8809410701", "8809411502")) %>% mutate(plot_name=as.character(1:10))
FERLD <- read.csv("~/PhD/Chap1/SORTIE/Change_par_lancer_SORTIE/Data/FERLD_PEP_climateNA/FERLD_climateNA.csv") %>%
mutate(plot_name="")
dom_bio <- readOGR(dsn = "~/PhD/Data/ShapeFiles/Quebec/Sous_domaine_bioclimatique/sous_dom_bioclim.shp",
layer = "sous_dom_bioclim")
lim_ers <- readOGR(dsn = "~/PhD/Data/ShapeFiles/Limite_distribution_espece/ERS_northern_boundary.shp",
layer = "ERS_northern_boundary")
lim_ers <- spTransform(lim_ers, CRS("+proj=longlat +ellps=WGS84 +datum=WGS84"))
lim_err <- readOGR(dsn = "~/PhD/Data/ShapeFiles/Limite_distribution_espece/ERR_northern_boundary.shp",
layer = "ERR_northern_boundary")
lim_err <- spTransform(lim_err, CRS("+proj=longlat +ellps=WGS84 +datum=WGS84"))
lim_boj <- readOGR(dsn = "~/PhD/Data/ShapeFiles/Limite_distribution_espece/BOJ_northern_boundary.shp",
layer = "BOJ_northern_boundary")
lim_boj <- spTransform(lim_boj, CRS("+proj=longlat +ellps=WGS84 +datum=WGS84"))
lims <- raster::bind(lim_ers, lim_err, lim_boj)
PEP <- PEP %>% mutate(ID="Validation plots") %>% select(-ID1, -ID2)
FERLD <- FERLD %>% mutate(ID="FERLD") %>% select(-ID1, -ID2)
data <- rbind(PEP, FERLD)
dom_bio_map <- subset(dom_bio, dom_bio$DOM_BIO %in% c("4", "5"))
dom_bio_map <- spTransform(dom_bio_map, CRS("+proj=longlat +ellps=WGS84 +datum=WGS84"))
canada <- sf::st_as_sf(map('world', regions="canada", plot = FALSE, fill = TRUE))
world <- sf::st_as_sf(map('world', plot = FALSE, fill = TRUE))
lim_bio <- dom_bio_map@bbox
dom_bio_map <- st_as_sf(dom_bio_map)
dom_bio_map  = st_sf(
aggregate(
dom_bio_map,
by=list(DOM_BIO=dom_bio_map$DOM_BIO),
FUN=function(vals){vals[1]}))
lims <- st_as_sf(lims)
lims$Species <- c("Sugar maple", "Red maple", "Yellow birch")
color_blind <- c('black','#EE7733', '#0077BB', "#009E73", "#F0E442", '#33BBEE', '#EE3377', '#CC3311', '#009988', '#AA4499') #https://stackoverflow.com/questions/57153428/r-plot-color-combinations-that-are-colorblind-accessible
# color_blind <- unname(palette.colors(palette = "Okabe-Ito"))
# unname(palette.colors(palette = "Okabe-Ito"))
# "#000000" "#E69F00" "#56B4E9" "#009E73" "#F0E442" "#0072B2" "#D55E00" "#CC79A7" "#999999"
data <- filter(data, ID=="FERLD")
city <- data.frame(lat=c(48.240159573340556,48.4283216292837, 46.812053590231876),
long=c(-79.06310652099977, -71.06108542399473, -71.22425987422862),
ID=c("Rouyn-Noranda", "Saguenay", "Quebec city"))
main <- ggplot()+ geom_sf(data = canada) +
geom_sf(data=dom_bio_map, aes(fill=DOM_BIO.1), alpha=0.6) +
scale_fill_manual(values=c(color_blind[5], color_blind[4]),
breaks = c("4", "5"),
labels = c("Temperate mixedwood forest", "Boreal mixedwood forest")) +
labs(fill=" ") +
geom_sf(data=lims, aes(color=Species), linewidth=3) +
labs(color="Continuous northern\ndistribution limit") +
scale_color_manual(values=c(color_blind[2], color_blind[3], color_blind[10])) +
new_scale_color() +
geom_point(data=data, aes(x=long, y=lat, color=ID), size=5)+
geom_point(data=city, aes(x=long, y=lat), shape=15)+
geom_text(data=city, aes(x=long, y=lat, label = ID), hjust=-0.05, vjust=0.3) +
scale_color_manual(values=c(color_blind[1], color_blind[2])) +
# geom_text(data=data, aes(x=long, y=lat, label=plot_name)) +
labs(color="Study area")+
coord_sf(xlim = c(lim_bio[1,1]+0.45, lim_bio[1,2]+lim_bio[1,2]/7), ylim = c(lim_bio[2,1], lim_bio[2,2]-0.4), expand=T) +
theme_bw() +
theme(legend.position="bottom", legend.box="vertical", legend.margin=margin()) +
annotation_north_arrow(location = "bl", which_north = "true",
pad_x = unit(0.05, "in"), pad_y = unit(0.15, "in"),
style = north_arrow_fancy_orienteering) +
annotation_scale(location = "bl", width_hint = 0.35, height = unit(0.1, "cm")) +
xlab("Latitude") +
ylab("Longitude")+
theme(legend.title.align = 0.5,
panel.background = element_rect(fill = "dodgerblue3"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text = element_text(size = 14),
axis.title = element_text(size = 15),
legend.text = element_text(size = 14),
legend.title = element_text(size = 15),
legend.key=element_blank(),
strip.text = element_text(size = 12),
plot.title = element_text(size = 16)
) +
guides(color=guide_legend(override.aes=list(fill=NA)))
countries <- data.frame(lat=c(51.66781288717857, 38.99658150626441),
long=c(-90.42096831020812, -88.50786675658247),
country=c("Canada", "USA"))
emprise <- ggplot(data=world) +
geom_sf() +
geom_text(data=countries, aes(x=long, y=lat, label=country), size=2.5)+
#???coord_sf(xlim = c(lim_bio[1,1], lim_bio[1,2]+lim_bio[1,2]/7), ylim = c(lim_bio[2,1], lim_bio[2,2]), expand = FALSE) +
coord_sf(xlim = c(-99, -51), ylim = c(30, 62), expand = FALSE) +
theme_void() +
annotate("rect", xmin = lim_bio[1,1]+0.45, xmax = lim_bio[1,2]+lim_bio[1,2]/7, ymin = lim_bio[2,1], ymax = lim_bio[2,2]-0.4,
alpha = .6, fill = "grey50", color="black",size=0.5) +
theme(
panel.background = element_rect(fill = "dodgerblue3"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(color = "black",
fill = NA,
size = 1))
map <-
ggdraw() +
draw_plot(main) +
draw_plot(emprise, x=0.83, y=0.7, width=.15, height=.15)
# climate <- readRDS(file="~/PhD/chap3/article/figures/map/climate_ferld.rds") %>%
#   pivot_longer(cols = CMI_JJA:MAT, names_to="climate", values_to = "values")
#
# clim_plot <- ggplot(climate, aes(x=as.numeric(period), y=values, group=rcp, col=rcp)) + geom_point() + geom_line() +
#   facet_wrap(~climate, scale="free", nrow=1) +
#   ylab("Climate values at LDRTF") + xlab("Time (in year)") +
#   labs(color="Climate scenario")+ theme(legend.position="bottom")
pdf(file="~/PhD/chap3/article/figures/map/map_ggplot.pdf")
map
dev.off()
png(filename="~/PhD/chap3/article/figures/map/map_ggplot.png", units = "in", width=7, height=7, res=900)
map
dev.off()
#Maintenant la carte de la FERLD
ferld_contour <- st_read("~/PhD/Data/LDTRF/Carte/FERLD_Partage/FERLD_Contour.shp")
chemin <- st_read("~/PhD/Data/LDTRF/Carte/FERLD_Partage/Chemins_FERLD_2022_ajour.shp")
MH <- st_read("~/PhD/Data/LDTRF/Carte/FERLD_Partage/Milieux_Humides.shp")
ruisseaux <- st_read("~/PhD/Data/LDTRF/Carte/FERLD_Partage/ruisseau3.shp")
lacs <- st_read("~/PhD/Data/LDTRF/Carte/FERLD_Partage/eau_inond3.shp")
feux <- st_read("~/PhD/Data/LDTRF/Carte/FERLD_Partage/FERLD_Feux.shp") %>%
filter(DATE_FEU %in% c(1760, 1823, 1923, 1964)) %>%
mutate(DATE_FEU=as.character(DATE_FEU))
feux2 <- st_read("~/PhD/Data/LDTRF/Carte/FERLD_Partage/firemapkafka_mtm10.shp") %>%
filter(CLASSE1 %in% c(1964)) %>%
slice(1) %>%
mutate(CLASSE1=as.character(CLASSE1))
lim1 <- st_bbox(ferld_contour)
lim2 <- st_bbox(feux2)
feux$DATE_FEU  <- factor(feux$DATE_FEU,
levels = c("1760", "1823", "1923", "1964"),
labels = c("1760", "1823", "1923", "1964"))
lake_name <- data.frame(lake=c("Hébécourt\nlake", "Duparquet\nlake"),
x=c(313000, 318700),
y=c(5373914, 5368914))
ferld <- ggplot()+
geom_sf(data=feux, aes(fill=as.character(DATE_FEU))) +
geom_sf(data=feux2, aes(fill=as.character(CLASSE1))) +
scale_fill_viridis_d("Fire year", option="plasma") +
#geom_sf(data=ferld_contour) +
geom_sf(data=chemin) +
geom_sf(data=MH, color="deepskyblue") +
geom_sf(data=ruisseaux, color="deepskyblue") +
geom_sf(data=lacs, fill="deepskyblue") +
#geom_text(data=lake_name, aes(x=x, y=y, label=lake), color="white", size=6)+
coord_sf(xlim = c(lim1[1], lim1[3]), ylim = c(lim1[2], lim2[4]), expand=T) +
annotation_north_arrow(location = "bl", which_north = "true",
pad_x = unit(0.05, "in"), pad_y = unit(0.15, "in"),
style = north_arrow_fancy_orienteering) +
annotation_scale(location = "bl", width_hint = 0.35, height = unit(0.1, "cm"))+
theme(legend.title.align = 0.5,
panel.background = element_rect(fill = "white"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text = element_text(size = 14),
axis.title = element_text(size = 15),
legend.text = element_text(size = 14),
legend.title = element_text(size = 15),
strip.text = element_text(size = 12),
plot.title = element_text(size = 16),
legend.position="bottom"
) + ggtitle(" FERLD territory")
ferld
pdf(file="~/PhD/chap3/article/figures/map/ferld.pdf", width=5, height=5)
ferld
dev.off()
png(filename="~/PhD/chap3/article/figures/map/ferld.png", units = "in", width=7, height=7, res=900)
ferld
dev.off()
pdf(file="~/PhD/chap3/article/figures/map/map_ferld.pdf",  width=14, height=5.5)
ggarrange(map, ferld, labels=c("A", "B"), font.label = list(size = 20))
dev.off()
ggarrange(map, ferld, labels=c("A", "B"), font.label = list(size = 20))
setwd("~/PhD/chap3/Temperate_species_colonisation_in_mixedwood_boreal_forest_with_climate_change/data_analysis")
rm(list=ls())
library(tidyverse)
theme_set(theme_bw())
library(ggh4x)
res_ad <- readRDS("../result_simulations/res_detailed_adult.rds")%>%
filter(species %in% c("Red_Maple", "Sugar_Maple", "Yellow_Birch"))
res_sap <- readRDS("../result_simulations/res_detailed_sapling.rds")%>%
filter(species %in% c("Red_Maple", "Sugar_Maple", "Yellow_Birch"))
res <- bind_rows(res_ad, res_sap)%>%
filter(!is.na(DBH), patch_size != "NA") %>%
mutate(year=as.numeric(timestep)+1991) %>%
dplyr::select(-perturbation, -timestep) %>%
filter(climate_scenario=="ssp245")
resd <- res %>%
mutate(d=(X-50)^2+(Y - 50)^2) %>%
mutate(patch_size=ifelse(patch_size=="NA", "0", patch_size)) %>%
mutate(d2=as.numeric(patch_size)/pi) %>%
filter(d2<d) %>%
mutate(angle=acos(abs(X-50)/sqrt(d))) %>%
mutate(subplot=case_when(X<=50 & Y > 50 & angle>pi/4 ~ "1",
X<=50 & Y > 50 & angle<=pi/4 ~ "2",
X>50 & Y > 50 & angle>pi/4 ~ "3",
X>50 & Y > 50 & angle<=pi/4 ~ "4",
X>50 & Y <= 50 & angle>pi/4 ~ "5",
X>50 & Y <= 50 & angle<=pi/4 ~ "6",
X<=50 & Y <= 50 & angle>pi/4 ~ "7",
X<=50 & Y <= 50 & angle<=pi/4 ~ "8"))
res2 <- resd %>%
group_by(fire_year, species_test, patch_size, species, year) %>%
count()
#Add zeros when absent
des <- expand(unique(res2[,-c(5,6)]), rbind(data.frame(year=c(1991)), unique(res2[,c(5)])))
res3 <- right_join(res2, des)
sum(is.na(res3))
res3[is.na(res3)] <- 0
res3$fire_year <- factor(res3$fire_year,
levels = c("1760", "1823", "1964", "1923"),
labels = c("1760", "1823", "1964", "1923 - Harvested"))
res3$species <- factor(res3$species,
levels = c("Red_Maple", "Sugar_Maple", "Yellow_Birch"),
labels = c("Red Maple", "Sugar Maple", "Yellow Birch"))
pdf(file = "../figures/number_stems.pdf", width = 8, height =10)
ggplot(res3, aes(x=year, y=n, color=species, group=species)) +
geom_line(linewidth=1) +
facet_nested(as.numeric(patch_size)~fire_year, scale="free_y") +
ylab("Number of stems (juveniles + adults)") + xlab("Year") +
theme(axis.text = element_text(size = 10),
axis.title = element_text(size = 14),
legend.text = element_text(size = 14),
legend.title = element_text(size = 14),
strip.text = element_text(size = 12),
plot.title = element_text(size = 16)) +
theme(legend.position="bottom")
dev.off()
png(filename = "../figures/number_stems.png", width = 8, height =10, units="in", res=1000)
ggplot(res3, aes(x=year, y=n, color=species, group=species)) +
geom_line(linewidth=1) +
facet_nested(as.numeric(patch_size)~fire_year, scale="free_y") +
ylab("Number of stems (juveniles + adults)") + xlab("Year") +
theme(axis.text = element_text(size = 10),
axis.title = element_text(size = 14),
legend.text = element_text(size = 14),
legend.title = element_text(size = 14),
strip.text = element_text(size = 12),
plot.title = element_text(size = 16)) +
theme(legend.position="bottom")
dev.off()
rm(list=ls())
gc()
library(tidyverse)
theme_set(theme_bw())
library(FactoMineR)
library(factoextra)
library(RColorBrewer)
library(gtable)
library(grid)
library(ggh4x)
library(ggpubr)
rm(list=ls())
gc()
library(tidyverse)
theme_set(theme_bw())
library(FactoMineR)
library(factoextra)
library(RColorBrewer)
library(gtable)
library(grid)
library(ggh4x)
library(ggpubr)
res_ad <- readRDS(file="../simulation/result_simulations/res_detailed_adult.rds")
rm(list=ls())
gc()
library(tidyverse)
theme_set(theme_bw())
library(FactoMineR)
library(factoextra)
library(RColorBrewer)
library(gtable)
library(grid)
library(ggh4x)
library(ggpubr)
res_ad <- readRDS(file="../result_simulations/res_detailed_adult.rds")
res_sap <- readRDS(file="../result_simulations/res_detailed_sapling.rds")
res <- bind_rows(res_ad, res_sap) %>%
select(-perturbation) %>%
filter(!is.na(DBH)) %>%
mutate(year=as.numeric(timestep)+1990) %>%
mutate(d=(X-50)^2+(Y - 50)^2,
patch_size=ifelse(patch_size=="NA", "0", patch_size),
d2=as.numeric(patch_size)/pi) %>%
filter(d2<d) %>%
#BA calculation for each species and each simulation
group_by(fire_year, species_test, patch_size, species, year, climate_scenario) %>%
summarize(BA=sum(((DBH*0.01)/2)^2*pi, na.rm=T)) %>%
mutate(BA=BA*(1-as.numeric(patch_size)/10000)) %>%
ungroup() %>%
pivot_wider(names_from="species", values_from=BA, values_fill=0) %>%
group_by(fire_year, species_test, patch_size, year, climate_scenario) %>%
summarize_all(sum)
tail(res)
colnames(res)[6:14] <- c("Balsam fir", "Jack pine", "Paper birch", "Trembling aspen", "White cedar",
"White spruce", "Yellow birch", "Red maple", "Sugar maple")
#La PCA
res.pca <- PCA(scale(res[6:14]),  graph = FALSE)
#Graphique des varainces expliqu?es par les axes
fviz_screeplot(res.pca, addlabels = TRUE, ylim = c(0, 50))
#Cercle de corr?lation avec en couleur les contributions
fviz_pca_var(res.pca, col.var="contrib",
gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
repel = TRUE # Avoid text overlapping
)
cercle <- fviz_pca_var(res.pca,repel = TRUE) +
theme(plot.title = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
text = element_text(size = 18),
axis.text = element_text(size = 12))
# Contributions of variables to PC1
fviz_contrib(res.pca, choice = "var", axes = 1, top = 10)
# Contributions of variables to PC2
fviz_contrib(res.pca, choice = "var", axes = 2, top = 10)
df_pca <- cbind(data.frame(get_pca_ind(res.pca)$coord), res)
centroid_fire_year <- df_pca %>%
group_by(year, fire_year, patch_size, species_test, climate_scenario) %>%
summarise(centroid_dim1=mean(Dim.1),
centroid_dim2=mean(Dim.2))
centroid_fire_year <- centroid_fire_year %>% filter(!fire_year %in% c("1910", "1923"))
centroid_fire_year$species_test <- factor(centroid_fire_year$species_test,
levels = c("control", "BOJ", "ERS", "ERR", "all"),
labels = c("Control", "Yellow birch", "Sugar maple", "Red maple", "All"))
centroid_fire_year$patch_size <- factor(centroid_fire_year$patch_size,
levels = c("0", "10", "30", "80", "150", "250", "400"))
control <- filter(centroid_fire_year, species_test=="Control")
centroid_fire_year <- filter(centroid_fire_year, species_test!="Control") %>%
bind_rows(mutate(control, species_test="Yellow birch"),
mutate(control, species_test="Red maple"),
mutate(control, species_test="Sugar maple"))
colnames(centroid_fire_year)[2:3] <- c("Fire year", "Patch size")
centroid_fire_year <- centroid_fire_year %>%
filter(`Patch size` %in% c("0","10", "80", "400")) %>%
mutate(patch="Patch size (in m²)")
centroid_fire_year <- centroid_fire_year %>%
rename(X=centroid_dim1, Y=centroid_dim2)
centroid_fire_year <- centroid_fire_year %>%
filter(climate_scenario =="ssp245") %>%
filter(`Patch size` %in% c("0", "400")) %>%
rename(` ` = `Patch size`)
centroid_fire_year$` ` <- factor(centroid_fire_year$` `,
levels = c("0", "80", "400"),
labels = c("No temperate trees", "80", "With temperate trees"))
p <- ggplot(centroid_fire_year, aes(x=X, y=Y,
color=` `, fill=` `,
group=interaction(`Fire year`, ` `),
shape=`Fire year`)) +
geom_hline(yintercept=0, linetype="dashed") +
geom_vline(xintercept=0, linetype="dashed") +
geom_path(alpha=1, linewidth=0.8) +
geom_point(data=filter(centroid_fire_year, year==2100), size=3) +
scale_size_manual(values=c(2,2,2,2.5,2.5,2)) +
geom_point(data=filter(centroid_fire_year, year==1990), aes(shape=`Fire year`), color="black", fill="black", size=4) +
scale_shape_manual(values=c(8, 16, 15,18,17,25)) +
#scale_color_manual(" ") +
facet_wrap(~species_test, ncol=2) +
xlab("Dimension 1 (30.8%)") + ylab("Dimension 2 (18.5%)") +
theme(axis.text = element_text(size = 18),
axis.title = element_text(size = 18),
legend.text = element_text(size = 18),
legend.title = element_text(size = 18),
strip.text = element_text(size = 16),
plot.title = element_text(size = 20),
legend.position="bottom",legend.box="vertical", legend.margin=margin())
p
pdf(file = "../figures/experimental_design/PCA.pdf", width = 7, height = 8)
pdf(file = "../figures/PCA.pdf", width = 7, height = 8)
p
dev.off()
pdf(file = "../figures/cercle.pdf", width = 7/2, height = 8/2)
cercle
dev.off()
